@page "/Company/List"
@using Gestao.Domain.Repositories
@using System.Security.Claims
@attribute [Authorize]
@rendermode InteractiveAuto
@inject ICompanyRepository repository
@inject AuthenticationStateProvider provider

<div class="card shadow-sm border-0">
    <div class="card-header d-flex align-items-center justify-content-between bg-light">
        <h4 class="card-title mb-0">Empresas</h4>
        <a href="/Company/Add" class="btn btn-primary btn-sm">
            <i class="ri-add-line me-1"></i> Cadastrar
        </a>
    </div>

    <div class="card-body">
        <div class="d-flex justify-content-between flex-wrap gap-2 mb-3">
            <div class="col-lg-4 p-0">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Buscar por nome ou CNPJ..." @bind="SearchWord">
                    <button class="btn btn-outline-success" type="button" @onclick="OnSearch">
                        <i class="ri-search-line"></i> Pesquisar
                    </button>
                </div>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Nome Fantasia</th>
                        <th>CNPJ</th>
                        <th>Endereço</th>
                        <th class="text-center">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Paginated == null)
                    {
                        <tr>
                            <td colspan="4" class="text-center">Carregando...</td>
                        </tr>
                    }
                    else if (Paginated.Items.Count == 0)
                    {
                        <tr>
                            <td colspan="4" class="text-center">Nenhum registro!</td>
                        </tr>
                    }
                    else
                    {
                        <tr>
                            <td>Mercado Costa</td>
                            <td>11.111.111/0001-11</td>
                            <td>Quadra 1 Bloco 2 LT 5</td>
                            <td class="text-center">
                                <button class="btn btn-sm btn-soft-success me-1" title="Selecionar">
                                    <i class="ri-check-line"></i> Selecionar
                                </button>
                                <button class="btn btn-sm btn-soft-info me-1" title="Editar">
                                    <i class="ri-pencil-line"></i>
                                </button>
                                <button class="btn btn-sm btn-soft-danger" title="Excluir">
                                    <i class="ri-delete-bin-line"></i>
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="d-flex flex-wrap align-items-center justify-content-between mt-3">
            <div class="text-muted small">
                Mostrando <span class="fw-semibold">5</span> de <span class="fw-semibold">25</span> registros
            </div>
            <nav>
                <ul class="pagination pagination-sm mb-0">
                    <li class="page-item disabled"><a class="page-link" href="#">←</a></li>
                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                    <li class="page-item active"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">→</a></li>
                </ul>
            </nav>
        </div>
    </div>
</div>


@code {
    private Guid applicationUserId;
    private PaginatedList<Company>? Paginated;
    private string SearchWord { get; set; } = string.Empty;

    private void OnSearch()
    {
        // Implement search logic here
    }

    protected override async Task OnInitializedAsync()
    {
        //Blazor Server pega o usuário logado via SignInManager
        //Blazor WebAssembly pega o usuário logado via AuthenticationStateProvider
        await GetAuthenticatedUserId();
        Paginated = await repository.GetAll(applicationUserId, 1, 0, SearchWord);
    }

    private async Task GetAuthenticatedUserId()
    {
        var authenticationState = await provider.GetAuthenticationStateAsync();
        var userId = authenticationState.User.Claims.FirstOrDefault(a => a.Type == ClaimTypes.NameIdentifier);

        if (userId != null)
            Guid.TryParse(userId?.Value, out applicationUserId);
    }
}












@* @page "/Company/List"
@attribute [Authorize]
@rendermode InteractiveAuto

<div class="col-xl-8"> 
<div class="card">
    <div class="card-header align-items-center d-flex">
        <h4 class="card-title mb-0 flex-grow-1">Empresas</h4>
        <div class="flex-shrink-0">
            <button type="button" class="btn btn-primary btn-md material-shadow-none">
                <i class="ri-file-list-3-line align-middle"></i> Cadastrar
            </button>
        </div>
    </div><!-- end card header -->

    <div class="card-body">        
        <div class="col-lg-6">
            <div class="input-group">
                <input type="text" class="form-control" aria-label="Recipient's username"
                    aria-describedby="button-addon2" placeholder="Digite a sua pesquisa">
                <button class="btn btn-outline-success material-shadow-none" type="button"
                    id="button-addon2">pesquisar</button>
            </div>
        </div>
        <div class="table-responsive mt-4 me-0" style="margin-left: -16px; margin-right: -16px;">
            <table class="table table-borderless table-centered align-middle table-nowrap mb-0">
                <thead class="text-muted table-light">
                    <tr>
                        <th scope="col">Nome Fantasia</th>
                        <th scope="col">CNPJ</th>
                        <th scope="col">Endereço</th>
                        <th scope="col">Ação</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            Mercado Costa
                        </td>
                        <td>
                            11.111.111/0001-11
                        </td>
                        <td>Quadra 1 Bloco 2 LT 5</td>
                        <td>
                            <a href="#" class="btn btn-sm btn-soft-success material-shadow-none"><i
                                    class="ri-check-line"></i></a>
                            <a href="#" class="btn btn-sm btn-soft-info material-shadow-none"><i
                                    class="ri-pencil-line"></i></a>
                            <a href="#" class="btn btn-sm btn-soft-danger material-shadow-none"><i
                                    class="ri-delete-bin-line"></i></a>
                        </td>
                    </tr><!-- end tr -->
                </tbody><!-- end tbody -->
            </table><!-- end table -->
             
            <div class="align-items-center mt-4 pt-2 justify-content-between row text-center text-sm-start">
                <div class="col-sm">
                    <div class="text-muted">
                        Mostrando <span class="fw-semibold">5</span> de <span class="fw-semibold">25</span>
                        registros
                    </div>
                </div>
                <div class="col-sm-auto  mt-3 mt-sm-0">
                    <ul class="pagination pagination-separated pagination-sm mb-0 justify-content-center">
                        <li class="page-item disabled">
                            <a href="#" class="page-link">←</a>
                        </li>
                        <li class="page-item">
                            <a href="#" class="page-link">1</a>
                        </li>
                        <li class="page-item active">
                            <a href="#" class="page-link">2</a>
                        </li>
                        <li class="page-item">
                            <a href="#" class="page-link">3</a>
                        </li>
                        <li class="page-item">
                            <a href="#" class="page-link">→</a>
                        </li>
                    </ul>
                </div>
            </div>

        </div>
    </div>
</div> <!-- .card-->
</div> 

@code {
    // This is a placeholder for the List page logic.
    // You can implement the logic to display a list of accounts here.
}  *@